<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Analytics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root{
            
            --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1e40af 100%);
        }
        
        body {
            background: #0f172a;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
        }

        .card {
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            color: #000000;
        }

        .profile-pic {
            border-radius: 50%;
            width: 120px;
            height: 120px;
            object-fit: cover;
            border: 3px solid #333;
        }

        .stats-card {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            background: #ffffff;
            transition: 0.3s;
        }

        /* .stats-card:hover {
            background: #3a3a3a;
            transform: translateY(-3px);
        } */

        .stats-card h6 {
            margin: 0;
            font-weight: 600;
            font-size: 1rem;
            color: #000000;
        }

        .stats-card small {
            color: #000000;
            font-size: 0.75rem;
        }

        .post-card {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }

        .post-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: 0.3s;
        }

        .post-card:hover img {
            transform: scale(1.05);
        }

        .post-overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 6px;
            background: rgba(0, 0, 0, 0.6);
            font-size: 0.7rem;
            display: flex;
            justify-content: space-between;
            color: #fff;
        }

        .form-control {
            background: #ffffff;
            color: #000000;
            border: none;
        }

        .form-control::placeholder {
            color: #888;
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
        }

        .alert {
            background: #2a2a2a;
            color: #e0e0e0;
            border: none;
        }

        canvas{
            color: #000000;
        }

        .stats-card i {
            color: rgb(0, 0, 0);
        }
        .post-card{
            height: 60vh;
        }
        .post-card img {
          height: 100%;
          width: 100%;
          object-fit: cover; /* makes the image cover the area nicely */
          display: block;
        }

        
    </style>
</head>

<body>
    <div class="nav-bar" style=" position: absolute; right: 0%; margin: 10px;" >
        <a href="{{ url_for('home_user') }}" class="btn btn-primary m-2">Home</a>
        <a href="{{ url_for('logout') }}" class="btn btn-primary m-2">ðŸšª Logout</a>
    </div>
    <div class="container py-4">
        <h2 class="text-center mb-4">Instagram Analytics Dashboard</h2>
        
        <form method="POST" class="d-flex justify-content-center mb-4">
            <input type="text" name="username" class="form-control w-50" placeholder="Enter Instagram username"
                required>
            <button class="btn btn-primary ms-2"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
        </form>

        {% if error %}
        <div class="alert text-center">{{ error }}</div>
        {% endif %}

        {% if profile %}
        <!-- Profile Info -->
        <div class="d-flex flex-column flex-md-row align-items-center mb-4">
            <img src="/proxy/{{ profile['profile_pic_url'] | url_encode }}" class="profile-pic me-md-4 mb-3 mb-md-0">
            <div>
                <h4>{{ profile['full_name'] }}
                    {% if profile['is_verified'] %}
                    <i class="fa-solid fa-circle-check text-primary"></i>
                    {% endif %}
                </h4>
                <h6 class="">@{{ profile['username'] }}</h6>
                <p class=" small">{{ profile['biography'] }}</p>
                <p class=" small">
                    <i class="fa-solid fa-lock"></i> {{ 'Private' if profile['is_private'] else 'Public' }} |
                    <i class="fa-solid fa-briefcase"></i> {{ profile['category'] }}
                </p>
                {% if profile['website'] != "N/A" %}
                <p class=" small">
                    <i class="fa-solid fa-link"></i>
                    <a href="{{ profile['website'] }}" target="_blank">{{ profile['website'] }}</a>
                </p>
                {% endif %}
            </div>
        </div>

        <!-- Stats -->
        <div class="row mb-4 g-3 justify-content-center">
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-camera fa-lg mb-1"></i>
                    <h6>{{ profile['posts'] }}</h6><small>Posts</small>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-users fa-lg mb-1"></i>
                    <h6>{{ profile['followers'] }}</h6><small>Followers</small>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-user-plus fa-lg mb-1"></i>
                    <h6>{{ profile['following'] }}</h6><small>Following</small>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-heart fa-lg text-danger mb-1"></i>
                    <h6>{{ summary['avg_likes'] }}</h6><small>Avg Likes</small>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-comment fa-lg text-primary mb-1"></i>
                    <h6>{{ summary['avg_comments'] }}</h6><small>Avg Comments</small>
                </div>
            </div>
            <div class="col-6 col-md-2">
                <div class="stats-card"><i class="fa-solid fa-chart-line fa-lg text-success mb-1"></i>
                    <h6>{{ summary['engagement_rate'] }}%</h6><small>Engagement</small>
                </div>
            </div>
        </div>

        {% if posts %}
        <!-- Charts -->
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <div class="card p-3">
                    <h6 class="mb-2">Likes & Comments Trend</h6>
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card p-3">
                    <h6 class="mb-2">Engagement Rate per Post (%)</h6>
                    <canvas id="engagementChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Posts -->
        <h6 class="mb-3 text-center" style="font-size: 30px;">Recent Posts</h6>
        <div class="row g-3">
            {% for post in posts %}
            <div class="col-10 col-md-3">
                <div class="post-card">
                    <a href="https://www.instagram.com/p/{{ post['shortcode'] }}/" target="_blank">
                        <img src="/proxy/{{ post['thumbnail'] | url_encode }}"
                            onerror="this.onerror=null;this.src='https://via.placeholder.com/400x400?text=No+Image';">
                        <div class="post-overlay">
                            <span><i class="fa-solid fa-heart text-danger"></i> {{ post['likes'] }}</span>
                            <span><i class="fa-solid fa-comment text-primary"></i> {{ post['comments'] }}</span>
                            <span>{{ post['timestamp'] }}</span>
                        </div>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- <script>
            const labels = [{% for post in posts %}'Post {{ loop.index }}', {% endfor %}];
            const likesData = [{% for post in posts %}{ { post['likes'] } }, {% endfor %}];
            const commentsData = [{% for post in posts %}{ { post['comments'] } }, {% endfor %}];
            const engagementData = [{% for post in posts %}{ { post['engagement_rate'] } }, {% endfor %}];

            new Chart(document.getElementById('trendChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        { label: 'Likes', data: likesData, borderColor: 'rgba(255,99,132,1)', backgroundColor: 'rgba(255,99,132,0.2)', tension: 0.3, fill: false, pointRadius: 4 },
                        { label: 'Comments', data: commentsData, borderColor: 'rgba(54,162,235,1)', backgroundColor: 'rgba(54,162,235,0.2)', tension: 0.3, fill: false, pointRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top', labels: { color: '#e0e0e0' } } },
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: { title: { display: true, text: 'Posts', color: '#e0e0e0' }, ticks: { color: '#e0e0e0' } },
                        y: { title: { display: true, text: 'Count', color: '#e0e0e0' }, ticks: { color: '#e0e0e0' } }
                    }
                }
            });

            new Chart(document.getElementById('engagementChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{ label: 'Engagement Rate (%)', data: engagementData, backgroundColor: 'rgba(75,192,192,0.6)' }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#e0e0e0' } } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Engagement Rate (%)', color: '#e0e0e0' }, ticks: { color: '#e0e0e0' } },
                        x: { ticks: { color: '#e0e0e0' } }
                    }
                }
            });
        </script> -->


        

        <script>
            // const labels = [{% for post in posts %}'Post {{ loop.index }}', {% endfor %}];
            // const likesData = [{% for post in posts %}{ { post['likes'] } }, {% endfor %}];
            // const commentsData = [{% for post in posts %}{ { post['comments'] } }, {% endfor %}];
            // const engagementData = [{% for post in posts %}{ { post['engagement_rate'] } }, {% endfor %}];

            const labels = {{ posts | map(attribute = 'shortcode') | list | tojson }};
                const likesData = {{ posts | map(attribute = 'likes') | list | tojson }};
                const commentsData = {{ posts | map(attribute = 'comments') | list | tojson }};
                const engagementData = {{ posts | map(attribute = 'engagement_rate') | list | tojson }};

            new Chart(document.getElementById('trendChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Likes',
                            data: likesData,
                            borderColor: 'rgba(255,99,132,1)',
                            backgroundColor: 'rgba(255,99,132,0.2)',
                            tension: 0.3,
                            fill: false,
                            pointRadius: 4
                        },
                        {
                            label: 'Comments',
                            data: commentsData,
                            borderColor: 'rgba(54,162,235,1)',
                            backgroundColor: 'rgba(54,162,235,0.2)',
                            tension: 0.3,
                            fill: false,
                            pointRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#000000' // Match your theme
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Posts',
                                color: '#000000'
                            },
                            ticks: {
                                color: '#000000'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Count',
                                color: '#000000'
                            },
                            ticks: {
                                color: '#000000'
                            }
                        }
                    }
                }
            });

            new Chart(document.getElementById('engagementChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Engagement Rate (%)',
                        data: engagementData,
                        backgroundColor: 'rgba(16,185,129,0.6)' // Using theme accent color
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#000000'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Engagement Rate (%)',
                                color: '#000000'
                            },
                            ticks: {
                                color: '#000000'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: ' Posts',
                                color: '#000000'
                            },
                            ticks: {
                                color: '#000000'
                            }
                        }
                    }
                }
            });
        </script>

        {% endif %}
        {% endif %}
    </div>
</body>

</html>